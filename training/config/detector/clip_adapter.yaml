# 基于 CLIP ViT-B/16 + 适配模块 的帧级跨域人脸伪造检测配置

# 日志目录（建议改成你本机的路径）
log_dir: ./logs/training/clip_adapter

# 模型设置
model_name: clip_adapter          # 对应 detectors 中注册的名字
backbone_name: vit                # 仅使用 CLIP 的视觉编码器

# backbone 相关设置（后续可根据需要扩展）
backbone_config:
  mode: ln_tuning                 # 冻结策略：ln_tuning（仅 LayerNorm）| last_n_layers（解冻最后 N 层）| full（全解冻）
  num_classes: 2
  inc: 3
  dropout: false
  # 当 mode=last_n_layers 时，解冻最后几层 Transformer（例如 2 表示最后 2 层）
  unfreeze_last_n_layers: 0

# 数据集与跨域评估设置
all_dataset: [FaceForensics++, FF-F2F, FF-DF, FF-FS, FF-NT, FaceShifter, DeepFakeDetection, Celeb-DF-v1, Celeb-DF-v2, DFDCP, DFDC, DeeperForensics-1.0, UADFV]
train_dataset: [FaceForensics++]  # 默认在 FF++ 上训练，可通过命令行覆盖
test_dataset: [FaceForensics++, Celeb-DF-v2]

compression: c23                  # 默认压缩等级
train_batchSize: 128
test_batchSize: 128
# Windows 上多进程 DataLoader 容易出现 cannot pickle 'Environment' object 等问题，先用单进程加载更稳定
workers: 0
frame_num: {'train': 32, 'test': 32}
resolution: 224                   # CLIP ViT-B/16 默认 224×224
with_mask: false
with_landmark: false

# 数据增强（图像域 + 预留特征层 Slerp）
use_data_augmentation: true
data_aug:
  flip_prob: 0.5
  rotate_prob: 0.5
  rotate_limit: [-10, 10]
  blur_prob: 0.5
  blur_limit: [3, 7]
  brightness_prob: 0.5
  brightness_limit: [-0.1, 0.1]
  contrast_limit: [-0.1, 0.1]
  quality_lower: 40
  quality_upper: 100
  # 特征层 Slerp 插值相关占位符（后续可在 dataset/trainer 中接入）
  use_slerp: false
  slerp_prob: 0.0

# 归一化
mean: [0.5, 0.5, 0.5]
std: [0.5, 0.5, 0.5]

# 优化器（与开题报告：Adam + 余弦退火 对齐）
optimizer:
  type: adam
  adam:
    lr: 0.0002
    beta1: 0.9
    beta2: 0.999
    eps: 0.00000001
    weight_decay: 0.0005
    amsgrad: false
  sgd:
    lr: 0.0002
    momentum: 0.9
    weight_decay: 0.0005

# 学习率调度器
lr_scheduler: cosine
lr_T_max: 10                      # 与 nEpochs 对齐
lr_eta_min: 0.0000001

# 训练控制
nEpochs: 10
start_epoch: 0
save_epoch: 1
rec_iter: 100
logdir: ./logs
manualSeed: 1024
save_ckpt: true
save_feat: true

# 模块开关（与课题设计对应）
modules:
  use_freq_adapter: true
  use_boundary_mining: true
  use_identity_invariant: true

# 损失函数与权重（目前先全部占位，实际实现时可逐步启用）
loss_func: cross_entropy
aux_losses:
  use_angle: false          # 角度约束（如 ArcFace 类损失）
  angle_weight: 0.1
  use_alignment: false      # 特征对齐/均匀约束
  alignment_weight: 0.1
  use_freq_consistency: false
  freq_consistency_weight: 0.1
  use_adversarial_identity: false  # 暂时关闭 GRL 对抗损失，先训练其他模块
  adversarial_identity_weight: 0.01
  # 身份分支相关
  id_dim: 128
  adv_lambda: 0.1

# 评估指标
metric_scoring: auc

# CUDA 相关
cuda: true
cudnn: true


